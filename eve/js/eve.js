window.AudioContext=window.AudioContext||window.webkitAudioContext;var EVE={synth:new AudioContext};EVE.synth.start=function(){"use strict";var E;for(E=0;E<EVE.oscillators.length;E+=1)EVE.oscillators[E].start(0)},function(){"use strict";function E(){this.parentElement.dataset.state="open"===this.parentElement.dataset.state?"closed":"open"}var e,o=document.querySelectorAll("section > h2, .toggle");for(e=0;e<o.length;e+=1)o[e].addEventListener("click",E)}(),EVE.keyboard=document.getElementById("keyboard"),EVE.config={harmonics:8,masterFreq:440,octaveShift:0},EVE.program={name:"INIT",osc1:1,osc2:0,osc3:0,osc4:0,osc5:0,osc6:0,osc7:0,osc8:0,osc1_eg:0,osc2_eg:0,osc3_eg:0,osc4_eg:0,osc5_eg:0,osc6_eg:0,osc7_eg:0,osc8_eg:0,timbre_a:0,timbre_d:0,timbre_s:0,timbre_r:0,lfo1_rate:4,lfo1_type:"square",osc1_lfo:0,osc2_lfo:0,osc3_lfo:0,osc4_lfo:0,osc5_lfo:0,osc6_lfo:0,osc7_lfo:0,osc8_lfo:0,lfo2_rate:3,lfo2_type:"sawtooth",lfo2_amp:0,lfo2_pitch:0,vca_a:0,vca_d:0,vca_s:1,vca_r:0,vca_g:0},EVE.now=function(){"use strict";return EVE.synth.currentTime},EVE.attack=function(E){"use strict";return console.log(typeof E),EVE.synth.currentTime+E},function(){"use strict";EVE.oscillators=[],function(){var E,e;for(EVE.harmonicOscs=[],E=1;E<=EVE.config.harmonics;E+=1)e="osc"+E,EVE[e]=EVE.synth.createOscillator(),EVE[e].frequency.value=EVE.config.masterFreq*E,EVE[e].type="sine",EVE.harmonicOscs.push(EVE[e]),EVE.oscillators.push(EVE[e])}(),function(){var E,e,o;for(EVE.harmonicVcas=[],E=1;E<=EVE.config.harmonics;E+=1)e="osc"+E,o=e+"_vca",EVE[o]=EVE.synth.createGain(),EVE[o].gain.setValueAtTime(EVE.program[e],EVE.now()),EVE.harmonicVcas.push(EVE[o])}(),function(){EVE.lfo1=EVE.synth.createOscillator(),EVE.lfo1.frequency.setValueAtTime(EVE.program.lfo1_rate,EVE.now()),EVE.lfo1.type=EVE.program.lfo1_type,EVE.oscillators.push(EVE.lfo1)}(),function(){var E,e,o;for(E=1;E<=EVE.config.harmonics;E+=1)e="osc"+E,o=e+"_lfo",EVE[o]=EVE.synth.createGain(),EVE[o].gain.setValueAtTime(EVE.program[o],EVE.now())}(),function(){EVE.lfo2=EVE.synth.createOscillator(),EVE.lfo2.frequency.setValueAtTime(EVE.program.lfo2_rate,EVE.now()),EVE.lfo2.type=EVE.program.lfo2_type,EVE.oscillators.push(EVE.lfo2)}(),function(){EVE.lfo2_amp=EVE.synth.createGain(),EVE.lfo2_amp.gain.setValueAtTime(EVE.program.lfo2_amp,EVE.now()),EVE.lfo2_pitch=EVE.synth.createGain(),EVE.lfo2_pitch.gain.setValueAtTime(EVE.program.lfo2_pitch,EVE.now())}(),function(){EVE.vca=EVE.synth.createGain(),EVE.vca.gain.setValueAtTime(EVE.program.vca_g,EVE.now())}(),function(){EVE.oscilloscope=EVE.synth.createAnalyser()}()}(),function(){"use strict";var E=2048,e=document.getElementById("scope"),o=e.getContext("2d"),t="rgb(53, 56, 55)",a=new Uint8Array(E);!function n(){var e,c,r,s=300/E,i=0;for(window.requestAnimationFrame(n),o.clearRect(0,0,300,150),o.lineWidth=2,o.strokeStyle=t,o.beginPath(),EVE.oscilloscope.getByteTimeDomainData(a),e=0;E>e;e+=1)c=a[e]/128,r=150*c/2,0===e?o.moveTo(i,r):o.lineTo(i,r),i+=s;o.lineTo(300,75),o.stroke()}()}(),function(){"use strict";!function(){var E,e,o;for(E=1;E<=EVE.config.harmonics;E+=1)e="osc"+E,o=e+"_vca",EVE[e].connect(EVE[o]),EVE[o].connect(EVE.vca)}(),function(){var E,e,o,t;for(E=1;E<=EVE.config.harmonics;E+=1)e="osc"+E,o=e+"_lfo",t=e+"_vca",EVE.lfo1.connect(EVE[o]),EVE[o].connect(EVE[t].gain)}(),function(){var E;for(EVE.lfo2.connect(EVE.lfo2_amp),EVE.lfo2.connect(EVE.lfo2_pitch),EVE.lfo2_amp.connect(EVE.vca.gain),E=1;E<=EVE.config.harmonics;E+=1)EVE.lfo2_pitch.connect(EVE["osc"+E].frequency);EVE.lfo2_pitch.connect(EVE.lfo1.frequency)}(),function(){EVE.vca.connect(EVE.oscilloscope),EVE.vca.connect(EVE.synth.destination)}()}(),EVE.calculatePitch=function(E){"use strict";var e,o=EVE.harmonicOscs;for("true"===EVE.program.lfo_tracking&&o.push(EVE.lfo),e=0;e<o.length;e+=1)o[e].detune.setValueAtTime(E,EVE.synth.currentTime)},EVE.gateOn=function(E){"use strict";var e,o,t,a,n=EVE.synth.currentTime+parseFloat(EVE.program.vca_a);for(e=1;e<=EVE.config.harmonics;e+=1)o=EVE["osc"+e+"_vca"],t=EVE.program["osc"+e],a=EVE.program["osc"+e+"_eg"],o.gain.setTargetAtTime(t,EVE.now(),.1),o.gain.linearRampToValueAtTime(parseFloat(t)+parseFloat(a),EVE.now()+parseFloat(EVE.program.timbre_a)),o.gain.setTargetAtTime(t+a*EVE.program.timbre_s,EVE.now()+parseFloat(EVE.program.timbre_a),EVE.program.timbre_d);return EVE.vca.gain.setTargetAtTime(EVE.program.vca_g,EVE.now(),.1),EVE.vca.gain.linearRampToValueAtTime(1,n),EVE.vca.gain.setTargetAtTime(EVE.program.vca_s+EVE.program.vca_g,n,EVE.program.vca_d),EVE.calculatePitch(E.target.dataset.noteValue)},EVE.keyboard.addEventListener("mousedown",EVE.gateOn),EVE.keyboard.addEventListener("touchstart",EVE.gateOn),EVE.gateOff=function(){"use strict";var E,e,o,t=EVE.vca.gain.value;for(o=1;o<=EVE.config.harmonics;o+=1)e=EVE["osc"+o+"_vca"],e.gain.cancelScheduledValues(EVE.now()),E=e.gain.value,e.gain.setValueAtTime(E,EVE.now()),e.gain.setTargetAtTime(EVE.program["osc"+o],EVE.now(),EVE.program.timbre_r);EVE.vca.gain.cancelScheduledValues(EVE.synth.currentTime),EVE.vca.gain.setValueAtTime(t,EVE.synth.currentTime),EVE.vca.gain.setTargetAtTime(EVE.program.vca_g,EVE.synth.currentTime,EVE.program.vca_r)},EVE.keyboard.addEventListener("mouseup",EVE.gateOff),EVE.keyboard.addEventListener("touchend",EVE.gateOff);