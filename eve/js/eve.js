window.AudioContext=window.AudioContext||window.webkitAudioContext;var EVE={config:{harmonics:8,masterFreq:440,octaveShift:0},program:{osc1:1,osc2:0,osc3:0,osc4:0,osc5:0,osc6:0,osc7:0,osc8:0},synth:new AudioContext};!function(){"use strict";function e(){this.parentElement.dataset.state="open"===this.parentElement.dataset.state?"closed":"open"}var t,o=document.querySelectorAll("section > a");for(t=0;t<o.length;t+=1)o[t].addEventListener("click",e)}(),EVE.keyboard=document.getElementById("keyboard"),EVE.program={name:"INIT",osc1:1,osc2:0,osc3:0,osc4:0,osc5:0,osc6:0,osc7:0,osc8:0,osc1_eg:0,osc2_eg:0,osc3_eg:0,osc4_eg:0,osc5_eg:0,osc6_eg:0,osc7_eg:0,osc8_eg:0,timbre_a:0,timbre_d:0,timbre_s:0,timbre_r:0,lfo1_rate:4,lfo1_track:!1,lfo1_type:"square",osc1_lfo:0,osc2_lfo:0,osc3_lfo:0,osc4_lfo:0,osc5_lfo:0,osc6_lfo:0,osc7_lfo:0,osc8_lfo:0,lfo2_rate:3,lfo2_type:"sawtooth",lfo2_amp:0,lfo2_pitch:0,vca_a:0,vca_d:0,vca_s:1,vca_r:0,vca_g:0},EVE.now=function(){"use strict";return EVE.synth.currentTime},EVE.attack=function(e){"use strict";return EVE.now()+e},EVE.oscilloscope=EVE.synth.createAnalyser(),function(){"use strict";var e=2048,t=document.getElementById("scope"),o=t.getContext("2d"),E="rgb(53, 56, 55)",c=new Uint8Array(e);!function a(){var t,n,r,s=300/e,i=0;for(window.requestAnimationFrame(a),o.clearRect(0,0,300,150),o.lineWidth=2,o.strokeStyle=E,o.beginPath(),EVE.oscilloscope.getByteTimeDomainData(c),t=0;e>t;t+=1)n=c[t]/128,r=150*n/2,0===t?o.moveTo(i,r):o.lineTo(i,r),i+=s;o.lineTo(300,75),o.stroke()}()}(),EVE.vca=EVE.synth.createGain(),EVE.vca.gain.value=EVE.program.vca_g,EVE.vca.connect(EVE.synth.destination),EVE.vca.connect(EVE.oscilloscope),EVE.harmonicOsc={},function(){"use strict";var e,t;for(e=1;e<=EVE.config.harmonics;e+=1)t="osc"+e,EVE.harmonicOsc[t]=EVE.synth.createOscillator(),EVE.harmonicOsc[t].frequency.value=EVE.config.masterFreq*e,EVE.harmonicOsc[t].type="sine",EVE.harmonicOsc[t].vca=EVE.synth.createGain(),EVE.harmonicOsc[t].vca.gain.value=EVE.program[t],EVE.harmonicOsc[t].connect(EVE.harmonicOsc[t].vca),EVE.harmonicOsc[t].vca.connect(EVE.vca)}(),EVE.lfo1={},function(){"use strict";var e,t,o;for(EVE.lfo1=EVE.synth.createOscillator(),EVE.lfo1.frequency.value=EVE.program.lfo1_rate,EVE.lfo1.type=EVE.program.lfo1_type,e=1;e<=EVE.config.harmonics;e+=1)t="osc"+e,o=t+"_lfo",EVE[o]=EVE.synth.createGain(),EVE[o].gain.value=EVE.program[o],EVE.lfo1.connect(EVE[o]),EVE[o].connect(EVE.harmonicOsc[t].vca.gain)}(),EVE.lfo2={},function(){"use strict";var e;for(EVE.lfo2=EVE.synth.createOscillator(),EVE.lfo2.frequency.value=EVE.program.lfo2_rate,EVE.lfo2.type=EVE.program.lfo2_type,EVE.lfo2_amp=EVE.synth.createGain(),EVE.lfo2_amp.gain.value=EVE.program.lfo2_amp,EVE.lfo2_pitch=EVE.synth.createGain(),EVE.lfo2_pitch.gain.value=EVE.program.lfo2_pitch,EVE.lfo2.connect(EVE.lfo2_amp),EVE.lfo2.connect(EVE.lfo2_pitch),EVE.lfo2_amp.connect(EVE.vca.gain),e=1;e<EVE.config.harmonics;e+=1)EVE.lfo2_pitch.connect(EVE.harmonicOsc["osc"+e].frequency);EVE.program.lfo1_track&&EVE.lfo2_pitch.connect(EVE.lfo1.frequency)}(),function(){"use strict";function e(){var t;for(t=1;t<=EVE.config.harmonics;t+=1)EVE.harmonicOsc["osc"+t].start(0);EVE.lfo1.start(0),EVE.lfo2.start(0),document.removeEventListener("click",e),document.removeEventListener("dblclick",e),document.removeEventListener("keydown",e),document.removeEventListener("touchstart",e),document.removeEventListener("wheel",e)}document.addEventListener("click",e),document.addEventListener("dblclick",e),document.addEventListener("keydown",e),document.addEventListener("touchstart",e),document.addEventListener("wheel",e)}(),EVE.slider={grab:function(){"use strict";console.log("grabbing slider")}},function(){"use strict";var e,t=document.querySelectorAll("input[type=range]");for(e=0;e<t.length;e+=1)t[e].addEventListener("input",EVE.slider.grab)}(),EVE.calculatePitch=function(e){"use strict";var t;for(t=1;t<=EVE.config.harmonics;t+=1)EVE.harmonicOsc["osc"+t].detune.setValueAtTime(e,EVE.now())},EVE.setPitch=function(e){"use strict";var t;for(t=1;t<=EVE.config.harmonics;t+=1)EVE.harmonicOsc["osc"+t].detune.setValueAtTime(e,EVE.now());return EVE.program.lfo1_track&&EVE.lfo1.detune.setValueAtTime(e,EVE.now()),console.log("Fool JSLint",e),"Should include portamento and staccato options"},EVE.gateOn=function(e){"use strict";var t,o,E,c,a=EVE.synth.currentTime+parseFloat(EVE.program.vca_a);for(t=1;t<=EVE.config.harmonics;t+=1)o=EVE.harmonicOsc["osc"+t].vca,E=EVE.program["osc"+t],c=EVE.program["osc"+t+"_eg"],o.gain.setTargetAtTime(E,EVE.now(),.1),o.gain.linearRampToValueAtTime(parseFloat(E)+parseFloat(c),EVE.now()+parseFloat(EVE.program.timbre_a)),o.gain.setTargetAtTime(E+c*EVE.program.timbre_s,EVE.now()+parseFloat(EVE.program.timbre_a),EVE.program.timbre_d);return EVE.vca.gain.setTargetAtTime(EVE.program.vca_g,EVE.now(),.1),EVE.vca.gain.linearRampToValueAtTime(1,a),EVE.vca.gain.setTargetAtTime(EVE.program.vca_s+EVE.program.vca_g,a,EVE.program.vca_d),EVE.calculatePitch(e.target.dataset.noteValue)},EVE.keyboard.addEventListener("mousedown",EVE.gateOn),EVE.keyboard.addEventListener("touchstart",EVE.gateOn),EVE.gateOff=function(){"use strict";var e,t,o,E=EVE.vca.gain.value;for(o=1;o<=EVE.config.harmonics;o+=1)t=EVE.harmonicOsc["osc"+o].vca,t.gain.cancelScheduledValues(EVE.now()),e=t.gain.value,t.gain.setValueAtTime(e,EVE.now()),t.gain.setTargetAtTime(EVE.program["osc"+o],EVE.now(),EVE.program.timbre_r);EVE.vca.gain.cancelScheduledValues(EVE.synth.currentTime),EVE.vca.gain.setValueAtTime(E,EVE.synth.currentTime),EVE.vca.gain.setTargetAtTime(EVE.program.vca_g,EVE.synth.currentTime,EVE.program.vca_r)},EVE.keyboard.addEventListener("mouseup",EVE.gateOff),EVE.keyboard.addEventListener("touchend",EVE.gateOff);