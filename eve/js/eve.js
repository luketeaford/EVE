var Config=Backbone.Model.extend({initialize:function(){"use strict";console.log("config created")}}),Program=Backbone.Model.extend({initialize:function(){"use strict";console.log("program created")}});window.AudioContext=window.AudioContext||window.webkitAudioContext;var EVE={synth:new AudioContext,playing:[],config:new Config({master_freq:444,octave_shift:0}),program:new Program({name:"INITIALIZE",osc1:1,osc2:0,osc3:0,osc4:0,osc5:0,osc6:0,osc7:0,osc8:0,vca_a:.01,vca_d:.4,vca_s:1,vca_r:.4,vca_g:0,lfo_amt:0,lfo_rate:0,trem_amt:0,trem_rate:0,vib_amt:0,vib_rate:0})};EVE.build_synth=function(){"use strict";var E=EVE.config.get("master_freq");EVE.vca=EVE.synth.createGain(),EVE.vca.connect(EVE.synth.destination),EVE.harmonic_mix=EVE.synth.createGain(),EVE.harmonic_mix.connect(EVE.vca),EVE.osc1=EVE.synth.createOscillator(),EVE.osc2=EVE.synth.createOscillator(),EVE.osc3=EVE.synth.createOscillator(),EVE.osc4=EVE.synth.createOscillator(),EVE.osc5=EVE.synth.createOscillator(),EVE.osc6=EVE.synth.createOscillator(),EVE.osc7=EVE.synth.createOscillator(),EVE.osc8=EVE.synth.createOscillator(),EVE.osc1_vca=EVE.synth.createGain(),EVE.osc2_vca=EVE.synth.createGain(),EVE.osc3_vca=EVE.synth.createGain(),EVE.osc4_vca=EVE.synth.createGain(),EVE.osc5_vca=EVE.synth.createGain(),EVE.osc6_vca=EVE.synth.createGain(),EVE.osc7_vca=EVE.synth.createGain(),EVE.osc8_vca=EVE.synth.createGain(),EVE.osc1.connect(EVE.osc1_vca),EVE.osc2.connect(EVE.osc2_vca),EVE.osc3.connect(EVE.osc3_vca),EVE.osc4.connect(EVE.osc4_vca),EVE.osc5.connect(EVE.osc5_vca),EVE.osc6.connect(EVE.osc6_vca),EVE.osc7.connect(EVE.osc7_vca),EVE.osc8.connect(EVE.osc8_vca),EVE.osc1_vca.connect(EVE.harmonic_mix),EVE.osc2_vca.connect(EVE.harmonic_mix),EVE.osc3_vca.connect(EVE.harmonic_mix),EVE.osc4_vca.connect(EVE.harmonic_mix),EVE.osc5_vca.connect(EVE.harmonic_mix),EVE.osc6_vca.connect(EVE.harmonic_mix),EVE.osc7_vca.connect(EVE.harmonic_mix),EVE.osc8_vca.connect(EVE.harmonic_mix),EVE.osc1.frequency.value=E,EVE.osc2.frequency.value=2*E,EVE.osc3.frequency.value=3*E,EVE.osc4.frequency.value=4*E,EVE.osc5.frequency.value=5*E,EVE.osc6.frequency.value=6*E,EVE.osc7.frequency.value=7*E,EVE.osc8.frequency.value=8*E,EVE.osc1_vca.gain.value=EVE.program.get("osc1"),EVE.osc2_vca.gain.value=EVE.program.get("osc2"),EVE.osc3_vca.gain.value=EVE.program.get("osc3"),EVE.osc4_vca.gain.value=EVE.program.get("osc4"),EVE.osc5_vca.gain.value=EVE.program.get("osc5"),EVE.osc6_vca.gain.value=EVE.program.get("osc6"),EVE.osc7_vca.gain.value=EVE.program.get("osc7"),EVE.osc8_vca.gain.value=EVE.program.get("osc8"),EVE.lfo=EVE.synth.createOscillator(),EVE.tremolo=EVE.synth.createOscillator(),EVE.vibrato=EVE.synth.createOscillator(),EVE.build_scope(),EVE.build_synth=function(){return void 0}},EVE.build_scope=function(){"use strict";function E(){var t,e,c,o=300/2048,a=0;for(window.requestAnimationFrame(E),EVE.ctx.clearRect(0,0,300,150),EVE.ctx.lineWidth=2,EVE.ctx.strokeStyle="rgb(242, 219, 33)",EVE.ctx.beginPath(),EVE.oscilloscope.getByteTimeDomainData(EVE.scope_data),t=0;2048>t;t+=1)e=EVE.scope_data[t]/128,c=150*e/2,0===t?EVE.ctx.moveTo(a,c):EVE.ctx.lineTo(a,c),a+=o;EVE.ctx.lineTo(300,75),EVE.ctx.stroke()}EVE.oscope=document.getElementById("scope"),EVE.ctx=EVE.oscope.getContext("2d"),EVE.oscilloscope=EVE.synth.createAnalyser(),EVE.oscilloscope.fftSize=2048,EVE.vca.connect(EVE.oscilloscope),EVE.scope_data=new Uint8Array(2048),E(),EVE.build_scope=function(){return void 0}},EVE.start_synth=function(){"use strict";EVE.osc1.start(0),EVE.osc2.start(0),EVE.osc3.start(0),EVE.osc4.start(0),EVE.osc5.start(0),EVE.osc6.start(0),EVE.osc7.start(0),EVE.osc8.start(0),EVE.lfo.start(0),EVE.tremolo.start(0),EVE.vibrato.start(0),$("#keyboard").off("mousedown keydown touchstart","button",EVE.start_synth),EVE.start_synth=function(){return void 0}},EVE.gate_on=function(E){"use strict";var t,e,c=0;(0===EVE.playing.length||EVE.legato===!1)&&EVE.amp_env_on(),this.getAttribute?(e=parseFloat(this.getAttribute("data-note-value")),t=(e+900)/100+60):(t=E.data[c],e=100*(t%12)-900),-1===EVE.playing.indexOf(t)&&EVE.playing.push(t),EVE.set_pitch(e)},EVE.amp_env_on=function(){"use strict";EVE.vca.gain.setTargetAtTime(EVE.program.get("vca_g"),EVE.synth.currentTime,.05),EVE.amp_attack()},EVE.amp_attack=function(){"use strict";var E=EVE.synth.currentTime+EVE.program.get("vca_a");EVE.vca.gain.linearRampToValueAtTime(1,E),EVE.vca.gain.setTargetAtTime(EVE.program.get("vca_s")+EVE.program.get("vca_g"),E,EVE.program.get("vca_d"))},EVE.gate_off=function(){"use strict";if(EVE.playing.pop(),EVE.playing.length){var E=EVE.playing.sort()[EVE.playing.length-1],t=100*(E%12)-900;EVE.set_pitch(t)}else EVE.amp_env_off()},EVE.amp_env_off=function(){"use strict";EVE.vca.gain.cancelScheduledValues(EVE.synth.currentTime),EVE.amp_release()},EVE.amp_release=function(){"use strict";var E=EVE.vca.gain.value;EVE.vca.gain.setValueAtTime(E,EVE.synth.currentTime),EVE.vca.gain.setTargetAtTime(EVE.program.get("vca_g"),EVE.synth.currentTime,EVE.program.get("vca_r"))},EVE.set_pitch=function(E){"use strict";var t,e,c=1200*EVE.config.get("octave_shift")+E;for(t=0;8>t;t+=1)e="osc"+(1+t),EVE[e].detune.setValueAtTime(c,EVE.synth.currentTime)},EVE.toggle_module=function(){"use strict";return this.dataset.state="closed"===this.dataset.state?"open":"closed",this},EVE.slider={grab:function(){"use strict";var E={program:this.getAttribute("data-program"),update:this.getAttribute("data-update")};return $(this).on("mousemove touchmove",E,EVE.store_program).on("mouseup touchend",EVE.slider.release)},release:function(){"use strict";return $(this).unbind("mousemove touchmove")}},EVE.update_osc1=function(){"use strict";return EVE.osc1_vca.gain.setValueAtTime(EVE.program.osc1*EVE.program.osc1,EVE.synth.currentTime)},EVE.update_osc2=function(){"use strict";return EVE.osc2_vca.gain.setValueAtTime(EVE.program.osc2*EVE.program.osc2,EVE.synth.currentTime)},EVE.update_osc3=function(){"use strict";return EVE.osc3_vca.gain.setValueAtTime(EVE.program.osc3*EVE.program.osc3,EVE.synth.currentTime)},EVE.update_osc4=function(){"use strict";return EVE.osc4_vca.gain.setValueAtTime(EVE.program.osc4*EVE.program.osc4,EVE.synth.currentTime)},EVE.update_osc5=function(){"use strict";return EVE.osc5_vca.gain.setValueAtTime(EVE.program.osc5*EVE.program.osc5,EVE.synth.currentTime)},EVE.update_osc6=function(){"use strict";return EVE.osc6_vca.gain.setValueAtTime(EVE.program.osc6*EVE.program.osc6,EVE.synth.currentTime)},EVE.update_osc7=function(){"use strict";return EVE.osc7_vca.gain.setValueAtTime(EVE.program.osc7*EVE.program.osc7,EVE.synth.currentTime)},EVE.update_osc8=function(){"use strict";return EVE.osc8_vca.gain.setValueAtTime(EVE.program.osc8*EVE.program.osc8,EVE.synth.currentTime)},EVE.store_program=function(E){"use strict";return EVE.program[E.data.program]=parseFloat(E.currentTarget.value),EVE[E.data.update]?EVE[E.data.update]():void 0},$(document).ready(function(){"use strict";EVE.build_synth(),$("section").on("click","h2",EVE.toggle_module),$("#harmonics").on("mousedown touchstart","input",EVE.slider.grab),$("#keyboard").one("mousedown keydown touchstart","button",EVE.start_synth).on("mousedown touchstart","button",EVE.gate_on).on("mouseup touchend","button",EVE.gate_off)});