window.AudioContext=window.AudioContext||window.webkitAudioContext;var EVE={synth:new AudioContext,master_freq:440,octave_shift:0,playing:[],program:{name:"INITIALIZE",osc1:0,osc2:0,osc3:0,osc4:0,osc5:0,osc6:0,osc7:0,osc8:0,vca_a:0,vca_d:0,vca_s:1,vca_r:0,vca_g:0,lfo_amt:0,lfo_rate:0,trem_amt:0,trem_rate:0,vib_amt:0,vib_rate:0}};EVE.build_synth=function(){"use strict";EVE.vca=EVE.synth.createGain(),EVE.vca.connect(EVE.synth.destination),EVE.harmonic_mix=EVE.synth.createGain(),EVE.harmonic_mix.connect(EVE.vca),EVE.osc1=EVE.synth.createOscillator(),EVE.osc2=EVE.synth.createOscillator(),EVE.osc3=EVE.synth.createOscillator(),EVE.osc4=EVE.synth.createOscillator(),EVE.osc5=EVE.synth.createOscillator(),EVE.osc6=EVE.synth.createOscillator(),EVE.osc7=EVE.synth.createOscillator(),EVE.osc8=EVE.synth.createOscillator(),EVE.osc1_vca=EVE.synth.createGain(),EVE.osc2_vca=EVE.synth.createGain(),EVE.osc3_vca=EVE.synth.createGain(),EVE.osc4_vca=EVE.synth.createGain(),EVE.osc5_vca=EVE.synth.createGain(),EVE.osc6_vca=EVE.synth.createGain(),EVE.osc7_vca=EVE.synth.createGain(),EVE.osc8_vca=EVE.synth.createGain(),EVE.osc1.connect(EVE.osc1_vca),EVE.osc2.connect(EVE.osc2_vca),EVE.osc3.connect(EVE.osc3_vca),EVE.osc4.connect(EVE.osc4_vca),EVE.osc5.connect(EVE.osc5_vca),EVE.osc6.connect(EVE.osc6_vca),EVE.osc7.connect(EVE.osc7_vca),EVE.osc8.connect(EVE.osc8_vca),EVE.osc1_vca.connect(EVE.harmonic_mix),EVE.osc2_vca.connect(EVE.harmonic_mix),EVE.osc3_vca.connect(EVE.harmonic_mix),EVE.osc4_vca.connect(EVE.harmonic_mix),EVE.osc5_vca.connect(EVE.harmonic_mix),EVE.osc6_vca.connect(EVE.harmonic_mix),EVE.osc7_vca.connect(EVE.harmonic_mix),EVE.osc8_vca.connect(EVE.harmonic_mix),EVE.osc1.frequency.value=EVE.master_freq,EVE.osc2.frequency.value=2*EVE.master_freq,EVE.osc3.frequency.value=3*EVE.master_freq,EVE.osc4.frequency.value=4*EVE.master_freq,EVE.osc5.frequency.value=5*EVE.master_freq,EVE.osc6.frequency.value=6*EVE.master_freq,EVE.osc7.frequency.value=7*EVE.master_freq,EVE.osc8.frequency.value=8*EVE.master_freq,EVE.osc1_vca.gain.value=0,EVE.osc2_vca.gain.value=0,EVE.osc3_vca.gain.value=0,EVE.osc4_vca.gain.value=0,EVE.osc5_vca.gain.value=0,EVE.osc6_vca.gain.value=0,EVE.osc7_vca.gain.value=0,EVE.osc8_vca.gain.value=0,EVE.lfo=EVE.synth.createOscillator(),EVE.tremolo=EVE.synth.createOscillator(),EVE.vibrato=EVE.synth.createOscillator(),EVE.build_scope(),EVE.build_synth=function(){return void 0}},EVE.build_scope=function(){"use strict";function E(){var t,c,e,a=300/2048,o=0;for(window.requestAnimationFrame(E),EVE.ctx.clearRect(0,0,300,150),EVE.ctx.lineWidth=2,EVE.ctx.strokeStyle="rgb(255, 255, 0)",EVE.ctx.beginPath(),EVE.oscilloscope.getByteTimeDomainData(EVE.scope_data),t=0;2048>t;t+=1)c=EVE.scope_data[t]/128,e=150*c/2,0===t?EVE.ctx.moveTo(o,e):EVE.ctx.lineTo(o,e),o+=a;EVE.ctx.lineTo(300,75),EVE.ctx.stroke()}EVE.oscope=document.getElementById("scope"),EVE.ctx=EVE.oscope.getContext("2d"),EVE.oscilloscope=EVE.synth.createAnalyser(),EVE.oscilloscope.fftSize=2048,EVE.vca.connect(EVE.oscilloscope),EVE.scope_data=new Uint8Array(2048),E()},EVE.start_synth=function(){"use strict";EVE.osc1.start(0),EVE.osc2.start(0),EVE.osc3.start(0),EVE.osc4.start(0),EVE.osc5.start(0),EVE.osc6.start(0),EVE.osc7.start(0),EVE.osc8.start(0),EVE.lfo.start(0),EVE.tremolo.start(0),EVE.vibrato.start(0),$("#keyboard").off("mousedown keydown touchstart","button",EVE.start_synth),EVE.start_synth=function(){return void 0}},EVE.gate_on=function(E){"use strict";var t,c,e=0;(0===EVE.playing.length||EVE.legato===!1)&&EVE.amp_env_on(),this.getAttribute?(c=parseFloat(this.getAttribute("data-note-value")),t=(c+900)/100+60):(t=E.data[e],c=100*(t%12)-900),-1===EVE.playing.indexOf(t)&&EVE.playing.push(t),EVE.set_pitch(c)},EVE.amp_env_on=function(){"use strict";EVE.vca.gain.setTargetAtTime(EVE.program.vca_g,EVE.synth.currentTime,.05),EVE.amp_attack()},EVE.amp_attack=function(){"use strict";var E=EVE.synth.currentTime+EVE.program.vca_a;EVE.vca.gain.linearRampToValueAtTime(1,E),EVE.vca.gain.setTargetAtTime(EVE.program.vca_s+EVE.program.vca_g,E,EVE.program.vca_d)},EVE.gate_off=function(){"use strict";if(EVE.playing.pop(),EVE.playing.length){var E=EVE.playing.sort()[EVE.playing.length-1],t=100*(E%12)-900;EVE.set_pitch(t)}else EVE.amp_env_off()},EVE.amp_env_off=function(){"use strict";EVE.vca.gain.cancelScheduledValues(EVE.synth.currentTime),EVE.amp_release()},EVE.amp_release=function(){"use strict";var E=EVE.vca.gain.value;EVE.vca.gain.setValueAtTime(E,EVE.synth.currentTime),EVE.vca.gain.setTargetAtTime(EVE.program.vca_g,EVE.synth.currentTime,EVE.program.vca_r)},EVE.set_pitch=function(E){"use strict";var t,c,e=1200*EVE.octave_shift+E;for(t=0;8>t;t+=1)c="osc"+(1+t),EVE[c].detune.setValueAtTime(e,EVE.synth.currentTime)},EVE.slider={grab:function(){"use strict";var E={program:this.getAttribute("data-program"),update:this.getAttribute("data-update")};return $(this).on("mousemove touchmove",E,EVE.store_program).on("mouseup touchend",EVE.slider.release)},release:function(){"use strict";return $(this).unbind("mousemove touchmove")}},EVE.update_osc1=function(){"use strict";return EVE.osc1_vca.gain.setValueAtTime(EVE.program.osc1*EVE.program.osc1,EVE.synth.currentTime)},EVE.update_osc2=function(){"use strict";return EVE.osc2_vca.gain.setValueAtTime(EVE.program.osc2*EVE.program.osc2,EVE.synth.currentTime)},EVE.update_osc3=function(){"use strict";return EVE.osc3_vca.gain.setValueAtTime(EVE.program.osc3*EVE.program.osc3,EVE.synth.currentTime)},EVE.update_osc4=function(){"use strict";return EVE.osc4_vca.gain.setValueAtTime(EVE.program.osc4*EVE.program.osc4,EVE.synth.currentTime)},EVE.update_osc5=function(){"use strict";return EVE.osc5_vca.gain.setValueAtTime(EVE.program.osc5*EVE.program.osc5,EVE.synth.currentTime)},EVE.update_osc6=function(){"use strict";return EVE.osc6_vca.gain.setValueAtTime(EVE.program.osc6*EVE.program.osc6,EVE.synth.currentTime)},EVE.update_osc7=function(){"use strict";return EVE.osc7_vca.gain.setValueAtTime(EVE.program.osc7*EVE.program.osc7,EVE.synth.currentTime)},EVE.update_osc8=function(){"use strict";return EVE.osc8_vca.gain.setValueAtTime(EVE.program.osc8*EVE.program.osc8,EVE.synth.currentTime)},EVE.store_program=function(E){"use strict";return EVE.program[E.data.program]=parseFloat(E.currentTarget.value),EVE[E.data.update]?EVE[E.data.update]():void 0},$(document).ready(function(){"use strict";EVE.build_synth(),$("#harmonics").on("mousedown touchstart","input",EVE.slider.grab),$("#keyboard").one("mousedown keydown touchstart","button",EVE.start_synth).on("mousedown touchstart","button",EVE.gate_on).on("mouseup touchend","button",EVE.gate_off)});